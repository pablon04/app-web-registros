<div class="container-muestra">
  
  <div class="registrar">
    <h2>Registrar Nueva Muestra</h2>
    <form (ngSubmit)="agregarRegistro()">
      <input type="text" placeholder="Nº Muestra" id="numeroMuestra" [(ngModel)]="numeroMuestra" name="numeroMuestra" required>
      <input type="date" id="fecha" [(ngModel)]="fecha" name="fecha" required>
      <input type="text" placeholder="Palet" id="palet" [(ngModel)]="palet" name="palet" required>
      <input type="text" placeholder="Ubicación Palet" id="ubicacionPalet" [(ngModel)]="ubicacionPalet" name="ubicacionPalet" required>

      <button type="submit" class="agregar-btn">
        <i class="fa-solid fa-plus"></i>Agregar
      </button>
    </form>
  </div>

  <div class="registros">
    <h2>Registros de Muestras</h2>

    <div class="div_search">
      <input type="search" 
         [(ngModel)]="busquedanumeroMuestra" 
         name="busquedanumeroMuestra" 
         class="main__input"
         placeholder="Buscar Nº Muestra">

      <input type="date" 
         [(ngModel)]="busquedafecha" 
         name="busquedafecha" 
         class="main__input"
         placeholder="Buscar Fecha">
      
      <input type="search" 
         [(ngModel)]="busquedapalet" 
         name="busquedapalet" 
         class="main__input"
         placeholder="Buscar Palet">

      <input type="search" 
         [(ngModel)]="busquedaubicacionPalet" 
         name="busquedaubicacionPalet" 
         class="main__input"
         placeholder="Buscar Ubicación Palet">
    </div>
    <table>
      <tr>
        <th>Nº Muestra</th>
        <th>Fecha Entrada</th>
        <th>Palet</th>
        <th>Ubicación Palet</th>
        <th>Acciones</th>
      </tr>
    @for (registro of registrosFiltrados; track registro; let i = $index) {
      
      <tr class="main__text" [ngClass]="{
        'destacado-numeroMuestra': busquedanumeroMuestra && registro.numeroMuestra.toLowerCase().includes(busquedanumeroMuestra.toLowerCase()),
        'destacado-fecha': busquedafecha && registro.fecha.toLowerCase().includes(busquedafecha.toLowerCase()),
        'destacado-palet': busquedapalet && registro.palet.toLowerCase().includes(busquedapalet.toLowerCase()),
        'destacado-ubicacionPalet': busquedaubicacionPalet && registro.ubicacionPalet.toLowerCase().includes(busquedaubicacionPalet.toLowerCase()),
        'fila-vencida': isDateOlderThanOneMonth(registro.fecha)
        }">
        <td class="numeroMuestra">
          <ng-container *ngIf="!registro.editando">{{ registro.numeroMuestra }}</ng-container>
          <input *ngIf="registro.editando" type="text" [(ngModel)]="registro.registroTemporal!.numeroMuestra">
        </td>
        <td class="fecha">
          <ng-container *ngIf="!registro.editando">{{ registro.fecha }}</ng-container>
          <input *ngIf="registro.editando" type="date" [(ngModel)]="registro.registroTemporal!.fecha">
        </td>
        <td class="palet">
          <ng-container *ngIf="!registro.editando">{{ registro.palet }}</ng-container>
          <input *ngIf="registro.editando" type="text" [(ngModel)]="registro.registroTemporal!.palet">
        </td>
        <td class="ubicacionPalet">
          <ng-container *ngIf="!registro.editando">{{ registro.ubicacionPalet }}</ng-container>
          <input *ngIf="registro.editando" type="text" [(ngModel)]="registro.registroTemporal!.ubicacionPalet">
        </td>
        <td class="acciones">
          <button type="button" class="editar-btn" (click)="editarRegistro(i)" *ngIf="!registro.editando">
            <i class="fas fa-edit"></i>
          </button>
          <button type="button" class="guardar-btn" (click)="guardarEdicion(i)" *ngIf="registro.editando">
            <i class="fas fa-save"></i>
          </button>
          <button type="button" class="eliminar-btn" (click)="eliminarRegistro(i)">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    }
      
    </table>
  </div>

</div>